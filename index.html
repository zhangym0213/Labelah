<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub 视频 & JSON 预览</title>
    <style>
        body {
            display: flex;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #videoSection, #textSection {
            display: flex;
            flex-direction: column;
            padding: 10px;
        }
        #videoSection {
            flex: 3;
            border-right: 2px solid #ccc;
        }
        #textSection {
            flex: 2;
        }
        input {
            width: 90%;
            padding: 5px;
            margin-bottom: 10px;
        }
        select {
            width: 95%;
            padding: 5px;
            height: 120px;
        }
        video {
            width: 100%;
            max-height: 60vh;
            margin-top: 10px;
        }
        textarea {
            width: 100%;
            height: 50vh;
            resize: none;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- 左侧视频区域 -->
    <div id="videoSection">
        <h3>搜索视频</h3>
        <input type="text" id="videoSearch" placeholder="输入视频名称">
        <select id="videoList" size="5"></select>
        <video id="videoPlayer" controls></video>
    </div>

    <!-- 右侧文字区域 -->
    <div id="textSection">
        <h3>搜索 JSON 文件</h3>
        <input type="text" id="jsonSearch" placeholder="输入 JSON 文件名称">
        <select id="jsonList" size="5"></select>

        <h4>筛选 JSON 内容</h4>
        <input type="text" id="filterVideo" placeholder="按 Video 筛选">
        <input type="text" id="filterSource" placeholder="按 Source 筛选">
        <input type="text" id="filterTask" placeholder="按 Task 筛选">

        <textarea id="jsonViewer" readonly></textarea>
    </div>

    <script>
        const repoOwner = "zhangym0213";  // GitHub 用户名
        const repoName = "Labelah";       // GitHub 仓库名
        let jsonData = [];  // 存储当前 JSON 数据

        // 加载视频文件列表
        async function loadVideos() {
            const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/videos`;
            const res = await fetch(url);
            const data = await res.json();
            const videoList = document.getElementById("videoList");

            data.forEach(file => {
                if (file.name.endsWith(".mp4") || file.name.endsWith(".webm")) {
                    let option = document.createElement("option");
                    option.value = file.download_url;
                    option.textContent = file.name;
                    videoList.appendChild(option);
                }
            });

            videoList.addEventListener("change", () => {
                document.getElementById("videoPlayer").src = videoList.value;
            });
        }

        // 加载 JSON 文件列表
        async function loadJsonFiles() {
            const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/data`;
            const res = await fetch(url);
            const data = await res.json();
            const jsonList = document.getElementById("jsonList");

            data.forEach(file => {
                if (file.name.endsWith(".json")) {
                    let option = document.createElement("option");
                    option.value = file.download_url;
                    option.textContent = file.name;
                    jsonList.appendChild(option);
                }
            });

            jsonList.addEventListener("change", async () => {
                const res = await fetch(jsonList.value);
                jsonData = await res.json();
                applyJsonFilters();
            });
        }

        // 过滤 JSON 数据
        function applyJsonFilters() {
            const videoFilter = document.getElementById("filterVideo").value.toLowerCase();
            const sourceFilter = document.getElementById("filterSource").value.toLowerCase();
            const taskFilter = document.getElementById("filterTask").value.toLowerCase();

            let filteredData = jsonData.filter(item => {
                return (!videoFilter || (item.Video && item.Video.toLowerCase().includes(videoFilter))) &&
                       (!sourceFilter || (item.Source && item.Source.toLowerCase().includes(sourceFilter))) &&
                       (!taskFilter || (item.Task && item.Task.toLowerCase().includes(taskFilter)));
            });

            document.getElementById("jsonViewer").value = JSON.stringify(filteredData, null, 2);
        }

        // 监听筛选框变化
        document.getElementById("filterVideo").addEventListener("input", applyJsonFilters);
        document.getElementById("filterSource").addEventListener("input", applyJsonFilters);
        document.getElementById("filterTask").addEventListener("input", applyJsonFilters);

        // 过滤搜索功能
        function setupSearch(inputId, listId) {
            document.getElementById(inputId).addEventListener("input", function () {
                const filter = this.value.toLowerCase();
                const options = document.getElementById(listId).options;

                for (let option of options) {
                    option.style.display = option.textContent.toLowerCase().includes(filter) ? "" : "none";
                }
            });
        }

        // 初始化
        loadVideos();
        loadJsonFiles();
        setupSearch("videoSearch", "videoList");
        setupSearch("jsonSearch", "jsonList");
    </script>
</body>
</html>
